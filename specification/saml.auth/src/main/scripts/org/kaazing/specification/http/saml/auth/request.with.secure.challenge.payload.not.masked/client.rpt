#
# Copyright 2007-2015, Kaazing Corporation. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

property location 'http://localhost:8080/echo'
property key ${ws:handshakeKey()}
property client125 ${ws:randomBytes(125)}

property challenge "Basic realm=\"demo\" saml-authn-request=\"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiB4bWxuczp4c2Q9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiBEZXN0aW5hdGlvbj0iaHR0cDovL2thYXppbmcuZXhhbXBsZS5jb20iIElEPSJfOWExMGNkYWJkMWZkNjUwZTE4Nzc2MzgzYWVlYjEzMzMiIElzc3VlSW5zdGFudD0iMjAxNy0wMS0xM1QxNDoyNzo1Ni4yOTNaIiBWZXJzaW9uPSIyLjAiPg0KPHNhbWwyOklzc3VlciB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+aHR0cDovL2lkcC5leGFtcGxlLmNvbTwvc2FtbDI6SXNzdWVyPg0KPGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+DQo8ZHM6U2lnbmVkSW5mbz4NCjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMS9SRUMteG1sLWMxNG4tMjAwMTAzMTUiLz4NCjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz4NCjxkczpSZWZlcmVuY2UgVVJJPSIjXzlhMTBjZGFiZDFmZDY1MGUxODc3NjM4M2FlZWIxMzMzIj4NCjxkczpUcmFuc2Zvcm1zPg0KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+DQo8ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj4NCjxlYzpJbmNsdXNpdmVOYW1lc3BhY2VzIHhtbG5zOmVjPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiIFByZWZpeExpc3Q9InhzZCIvPg0KPC9kczpUcmFuc2Zvcm0+DQo8L2RzOlRyYW5zZm9ybXM+DQo8ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+DQo8ZHM6RGlnZXN0VmFsdWU+R1hYcndvc2pXOHMzRWg2blJpMWcrcnlabXowMlVMOElzWTBDTkZ3Y2o1ST08L2RzOkRpZ2VzdFZhbHVlPg0KPC9kczpSZWZlcmVuY2U+DQo8L2RzOlNpZ25lZEluZm8+DQo8ZHM6U2lnbmF0dXJlVmFsdWU+DQpUSHNXMTk3WGZnU1Fya2lZcGZKWjBuUWxnOGxweitHbGFuNmNtb0RSTzl6NC9YaXVVN0F5SjlkaFMwODJKa2Q0TWRwUENpcWlPQXc0DQpwTVFBL09jSFc0Mjh1ZVJqRlF6NlRkcXlLeXFpdVhUSWxoQmNHNEhwd2ZtL0Vna0gzNGZLRDk1KzUxMlhRSDJHYlFjM2lzYXdhcDA5DQpQRGk1TDR0dG90WjkzNVJUZXVRPQ0KPC9kczpTaWduYXR1cmVWYWx1ZT4NCjwvZHM6U2lnbmF0dXJlPg0KPHNhbWwycDpTdGF0dXM+DQo8c2FtbDJwOlN0YXR1c0NvZGUgVmFsdWU9IlN1Y2Nlc3MiLz4NCjwvc2FtbDJwOlN0YXR1cz4NCjxzYW1sMjpBc3NlcnRpb24geG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfMTAxMDBmZGRlOGYzYzM2YzI5MzYwZjU1Y2I1ZmNmZWEiIElzc3VlSW5zdGFudD0iMjAxNy0wMS0xM1QxNDoyNzo1Ni4zMjFaIiBWZXJzaW9uPSIyLjAiPg0KPHNhbWwyOklzc3Vlcj5odHRwOi8vaWRwLmV4YW1wbGUuY29tPC9zYW1sMjpJc3N1ZXI+DQo8ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj4NCjxkczpTaWduZWRJbmZvPg0KPGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSIvPg0KPGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPg0KPGRzOlJlZmVyZW5jZSBVUkk9IiNfMTAxMDBmZGRlOGYzYzM2YzI5MzYwZjU1Y2I1ZmNmZWEiPg0KPGRzOlRyYW5zZm9ybXM+DQo8ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz4NCjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiPg0KPGVjOkluY2x1c2l2ZU5hbWVzcGFjZXMgeG1sbnM6ZWM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIgUHJlZml4TGlzdD0ieHNkIi8+DQo8L2RzOlRyYW5zZm9ybT4NCjwvZHM6VHJhbnNmb3Jtcz4NCjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNzaGEyNTYiLz4NCjxkczpEaWdlc3RWYWx1ZT5aV1Q4QTV4enNWZ0FOWlc3NnhZYUpnM0dGVnRINjNkNFErZzBlL1JoNDZNPTwvZHM6RGlnZXN0VmFsdWU+DQo8L2RzOlJlZmVyZW5jZT4NCjwvZHM6U2lnbmVkSW5mbz4NCjxkczpTaWduYXR1cmVWYWx1ZT4NCkxjaUF2T3ByR1hSa1ZyVEgvZVhnUVRsaVltN1lZcmVVK1QzVk9VenplaDhXa2VBZGdlK3REWGkreHFkRmtOazlkSzF0bUNRbnUvT2MNCmhMZ3NiZFo4ZlpZSis5VithMTNTdlA0aytNOHhQdjNSaXQ2ZVltditVZG5RMXhmWCtXUEpYNFhGbHB5RGhXd1ZBV3JnTDVhQzVSK1kNCnRKRzB1RExYdWFZV2pjUEozUzQ9DQo8L2RzOlNpZ25hdHVyZVZhbHVlPg0KPC9kczpTaWduYXR1cmU+DQo8c2FtbDI6U3ViamVjdD4NCjxzYW1sMjpOYW1lSUQgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoxLjE6bmFtZWlkLWZvcm1hdDplbWFpbEFkZHJlc3MiPlN0YW5kYXJkIEthYXppbmcgVXNlcjwvc2FtbDI6TmFtZUlEPg0KPHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj4NCjxzYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBOb3RPbk9yQWZ0ZXI9IjIwMTctMDEtMTVUMTY6Mjc6NTYuMjkzWiIgUmVjaXBpZW50PSJodHRwOi8va2FhemluZy5leGFtcGxlLmNvbSIvPg0KPC9zYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uPg0KPC9zYW1sMjpTdWJqZWN0Pg0KPHNhbWwyOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDE3LTAxLTEzVDE0OjI3OjU2LjMyMVoiIE5vdE9uT3JBZnRlcj0iMjAxNy0wMS0xNVQxNjoyNzo1Ni4yOTNaIj4NCjxzYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPg0KPHNhbWwyOkF1ZGllbmNlPmh0dHA6Ly9rYWF6aW5nLmV4YW1wbGUuY29tPC9zYW1sMjpBdWRpZW5jZT4NCjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj4NCjwvc2FtbDI6Q29uZGl0aW9ucz4NCjxzYW1sMjpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMTctMDEtMTNUMTQ6Mjc6NTYuMzI0WiI+DQo8c2FtbDI6QXV0aG5Db250ZXh0Pg0KPHNhbWwyOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkPC9zYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj4NCjwvc2FtbDI6QXV0aG5Db250ZXh0Pg0KPC9zYW1sMjpBdXRoblN0YXRlbWVudD4NCjxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+DQo8c2FtbDI6QXR0cmlidXRlIEZyaWVuZGx5TmFtZT0idWlkIiBOYW1lPSJ1aWQiPg0KPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj51aWQwMDAxMjMxPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4NCjwvc2FtbDI6QXR0cmlidXRlPg0KPC9zYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+DQo8L3NhbWwyOkFzc2VydGlvbj4NCjwvc2FtbDJwOlJlc3BvbnNlPg0K\""

property authnRequest "${saml:generateAuthn()}"
connect ${location}
connected

write method "GET"
write version "HTTP/1.1"
write header host
write header "Upgrade" "websocket"
write header "Connection" "Upgrade"
write header "Sec-WebSocket-Key" ${key}
write header "Sec-WebSocket-Version" "13"


read status "401" "Unauthorized"
read header "WWW-Authenticate" ${challenge} 
read notify FIRST_REQUEST_COMPLETE

connect await FIRST_REQUEST_COMPLETE
connect ${location}
connected

write method "GET"
write version "HTTP/1.1"
write header host
write header "Upgrade" "websocket"
write header "Authorization" "Basic realm=\"demo\" saml-authn-request=\"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiB4bWxuczp4c2Q9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiBEZXN0aW5hdGlvbj0iaHR0cDovL2thYXppbmcuZXhhbXBsZS5jb20iIElEPSJfOWExMGNkYWJkMWZkNjUwZTE4Nzc2MzgzYWVlYjEzMzMiIElzc3VlSW5zdGFudD0iMjAxNy0wMS0xM1QxNDoyNzo1Ni4yOTNaIiBWZXJzaW9uPSIyLjAiPg0KPHNhbWwyOklzc3VlciB4bWxuczpzYW1sMj0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+aHR0cDovL2lkcC5leGFtcGxlLmNvbTwvc2FtbDI6SXNzdWVyPg0KPGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+DQo8ZHM6U2lnbmVkSW5mbz4NCjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMS9SRUMteG1sLWMxNG4tMjAwMTAzMTUiLz4NCjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjcnNhLXNoYTEiLz4NCjxkczpSZWZlcmVuY2UgVVJJPSIjXzlhMTBjZGFiZDFmZDY1MGUxODc3NjM4M2FlZWIxMzMzIj4NCjxkczpUcmFuc2Zvcm1zPg0KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+DQo8ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj4NCjxlYzpJbmNsdXNpdmVOYW1lc3BhY2VzIHhtbG5zOmVjPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiIFByZWZpeExpc3Q9InhzZCIvPg0KPC9kczpUcmFuc2Zvcm0+DQo8L2RzOlRyYW5zZm9ybXM+DQo8ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+DQo8ZHM6RGlnZXN0VmFsdWU+R1hYcndvc2pXOHMzRWg2blJpMWcrcnlabXowMlVMOElzWTBDTkZ3Y2o1ST08L2RzOkRpZ2VzdFZhbHVlPg0KPC9kczpSZWZlcmVuY2U+DQo8L2RzOlNpZ25lZEluZm8+DQo8ZHM6U2lnbmF0dXJlVmFsdWU+DQpUSHNXMTk3WGZnU1Fya2lZcGZKWjBuUWxnOGxweitHbGFuNmNtb0RSTzl6NC9YaXVVN0F5SjlkaFMwODJKa2Q0TWRwUENpcWlPQXc0DQpwTVFBL09jSFc0Mjh1ZVJqRlF6NlRkcXlLeXFpdVhUSWxoQmNHNEhwd2ZtL0Vna0gzNGZLRDk1KzUxMlhRSDJHYlFjM2lzYXdhcDA5DQpQRGk1TDR0dG90WjkzNVJUZXVRPQ0KPC9kczpTaWduYXR1cmVWYWx1ZT4NCjwvZHM6U2lnbmF0dXJlPg0KPHNhbWwycDpTdGF0dXM+DQo8c2FtbDJwOlN0YXR1c0NvZGUgVmFsdWU9IlN1Y2Nlc3MiLz4NCjwvc2FtbDJwOlN0YXR1cz4NCjxzYW1sMjpBc3NlcnRpb24geG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfMTAxMDBmZGRlOGYzYzM2YzI5MzYwZjU1Y2I1ZmNmZWEiIElzc3VlSW5zdGFudD0iMjAxNy0wMS0xM1QxNDoyNzo1Ni4zMjFaIiBWZXJzaW9uPSIyLjAiPg0KPHNhbWwyOklzc3Vlcj5odHRwOi8vaWRwLmV4YW1wbGUuY29tPC9zYW1sMjpJc3N1ZXI+DQo8ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj4NCjxkczpTaWduZWRJbmZvPg0KPGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSIvPg0KPGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPg0KPGRzOlJlZmVyZW5jZSBVUkk9IiNfMTAxMDBmZGRlOGYzYzM2YzI5MzYwZjU1Y2I1ZmNmZWEiPg0KPGRzOlRyYW5zZm9ybXM+DQo8ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz4NCjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiPg0KPGVjOkluY2x1c2l2ZU5hbWVzcGFjZXMgeG1sbnM6ZWM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIgUHJlZml4TGlzdD0ieHNkIi8+DQo8L2RzOlRyYW5zZm9ybT4NCjwvZHM6VHJhbnNmb3Jtcz4NCjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNzaGEyNTYiLz4NCjxkczpEaWdlc3RWYWx1ZT5aV1Q4QTV4enNWZ0FOWlc3NnhZYUpnM0dGVnRINjNkNFErZzBlL1JoNDZNPTwvZHM6RGlnZXN0VmFsdWU+DQo8L2RzOlJlZmVyZW5jZT4NCjwvZHM6U2lnbmVkSW5mbz4NCjxkczpTaWduYXR1cmVWYWx1ZT4NCkxjaUF2T3ByR1hSa1ZyVEgvZVhnUVRsaVltN1lZcmVVK1QzVk9VenplaDhXa2VBZGdlK3REWGkreHFkRmtOazlkSzF0bUNRbnUvT2MNCmhMZ3NiZFo4ZlpZSis5VithMTNTdlA0aytNOHhQdjNSaXQ2ZVltditVZG5RMXhmWCtXUEpYNFhGbHB5RGhXd1ZBV3JnTDVhQzVSK1kNCnRKRzB1RExYdWFZV2pjUEozUzQ9DQo8L2RzOlNpZ25hdHVyZVZhbHVlPg0KPC9kczpTaWduYXR1cmU+DQo8c2FtbDI6U3ViamVjdD4NCjxzYW1sMjpOYW1lSUQgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoxLjE6bmFtZWlkLWZvcm1hdDplbWFpbEFkZHJlc3MiPlN0YW5kYXJkIEthYXppbmcgVXNlcjwvc2FtbDI6TmFtZUlEPg0KPHNhbWwyOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj4NCjxzYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBOb3RPbk9yQWZ0ZXI9IjIwMTctMDEtMTVUMTY6Mjc6NTYuMjkzWiIgUmVjaXBpZW50PSJodHRwOi8va2FhemluZy5leGFtcGxlLmNvbSIvPg0KPC9zYW1sMjpTdWJqZWN0Q29uZmlybWF0aW9uPg0KPC9zYW1sMjpTdWJqZWN0Pg0KPHNhbWwyOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDE3LTAxLTEzVDE0OjI3OjU2LjMyMVoiIE5vdE9uT3JBZnRlcj0iMjAxNy0wMS0xNVQxNjoyNzo1Ni4yOTNaIj4NCjxzYW1sMjpBdWRpZW5jZVJlc3RyaWN0aW9uPg0KPHNhbWwyOkF1ZGllbmNlPmh0dHA6Ly9rYWF6aW5nLmV4YW1wbGUuY29tPC9zYW1sMjpBdWRpZW5jZT4NCjwvc2FtbDI6QXVkaWVuY2VSZXN0cmljdGlvbj4NCjwvc2FtbDI6Q29uZGl0aW9ucz4NCjxzYW1sMjpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMTctMDEtMTNUMTQ6Mjc6NTYuMzI0WiI+DQo8c2FtbDI6QXV0aG5Db250ZXh0Pg0KPHNhbWwyOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkPC9zYW1sMjpBdXRobkNvbnRleHRDbGFzc1JlZj4NCjwvc2FtbDI6QXV0aG5Db250ZXh0Pg0KPC9zYW1sMjpBdXRoblN0YXRlbWVudD4NCjxzYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+DQo8c2FtbDI6QXR0cmlidXRlIEZyaWVuZGx5TmFtZT0idWlkIiBOYW1lPSJ1aWQiPg0KPHNhbWwyOkF0dHJpYnV0ZVZhbHVlIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIHhzaTp0eXBlPSJ4c2Q6c3RyaW5nIj51aWQwMDAxMjMxPC9zYW1sMjpBdHRyaWJ1dGVWYWx1ZT4NCjwvc2FtbDI6QXR0cmlidXRlPg0KPC9zYW1sMjpBdHRyaWJ1dGVTdGF0ZW1lbnQ+DQo8L3NhbWwyOkFzc2VydGlvbj4NCjwvc2FtbDJwOlJlc3BvbnNlPg0K\""
write header "Connection" "Upgrade"
write header "Sec-WebSocket-Key" ${key}
write header "Sec-WebSocket-Version" "13"


read status "101" /.+/
read version "HTTP/1.1"
read header "Upgrade" /(?i:websocket)/
read header "Connection" /(?i:Upgrade)/
read header "Sec-WebSocket-Accept" ${ws:handshakeHash(key)}

write [0x82 0x7d]
write ${client125}

read [0x88 0x02 0x03 0xea]